name: Check Models

on: 
  pull_request:
    paths:
      - 'models/**'

jobs:
  check-models:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Fetch base branch
        run: git fetch origin ${{ github.base_ref }}

      - name: Check for deleted or modified models under models folder
        run: |
          git diff --name-only origin/${{ github.base_ref }} | grep -E '^models/' || true
          if [ $? -ne 0 ]; then
            echo "No models were modified or deleted."
          else
            echo "Models have been modified or deleted."
            exit 1
          fi

      - name: Check for removed or changed lines in added/renamed files
        run: |
          git diff --name-only --diff-filter=AR origin/${{ github.base_ref }} | grep -E '^models/' | while read file; do
            if [ -f "$file" ]; then
              if git diff --cached -- "$file" | grep -q '^\+'; then
                echo "File $file has added lines."
              fi
              if git diff --cached -- "$file" | grep -q '^\-'; then
                echo "File $file has removed lines."
              fi
            fi
          done || true
          
      - name: Passed 
        run: echo "All checks passed. No models were modified or deleted, and no lines were removed or changed in added/renamed files."
        if: success()
        
      - name: Failed
        run: echo "Checks failed. Please review the modified or deleted models and ensure no lines were removed or changed in added/renamed files."
        if: failure()  